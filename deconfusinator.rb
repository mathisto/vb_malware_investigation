require 'pry'
require 'amazing_print'

file = File.open("malware.txt")
lines = file.readlines.map(&:chomp) # ["user1", "user2", "user3"]

# We suspect these comment lines to be completley ignored nonsense
lines.reject! { |line| line =~ /^REM.*/ }
lines.reject! { |line| line =~ /\' .*/ }

array_capture = /^\w+ = Array.*/
const_capture = /^const /
execute_capture = /^Execute.*/

arrays = []
byte_maps = []
execution_array = []

lines.each do |line|
  if line =~ array_capture
    arrays << line[/\(.*?\)/].gsub(/[\(\)]/, '').split(',')
  elsif line =~ const_capture
    byte_maps << line.gsub('const ', '').split(' = ')
  elsif line =~ execute_capture
    execution_array << line.gsub('Execute(headsman(', '')[0..-3]
  end
end

ap execution_array
